swagger: "2.0"

info:
  title: Configuration Service API
  description: API for managing configurations and configuration groups with versioning and labels
  version: "1.0.0"

host: localhost:8080
basePath: /
schemes:
  - http

consumes:
  - application/json
produces:
  - application/json

paths:

  /configs:
    post:
      summary: Create a new configuration
      description: Creates a new configuration with versioning support
      parameters:
        - name: config
          in: body
          required: true
          schema:
            $ref: "#/definitions/Config"
      responses:
        201:
          description: Configuration created
          schema:
            $ref: "#/definitions/Config"

  /configs/{id}/versions/{version}:
    get:
      summary: Get configuration by ID and version
      parameters:
        - name: id
          in: path
          required: true
          type: string
        - name: version
          in: path
          required: true
          type: string
      responses:
        200:
          description: Configuration found
          schema:
            $ref: "#/definitions/Config"
        404:
          description: Configuration not found

    delete:
      summary: Delete configuration by ID and version
      parameters:
        - name: id
          in: path
          required: true
          type: string
        - name: version
          in: path
          required: true
          type: string
      responses:
        204:
          description: Configuration deleted

  /groups:
    post:
      summary: Create a configuration group
      parameters:
        - name: group
          in: body
          required: true
          schema:
            $ref: "#/definitions/ConfigurationGroup"
      responses:
        201:
          description: Group created
          schema:
            $ref: "#/definitions/ConfigurationGroup"

  /groups/{name}/versions/{version}:
    get:
      summary: Get configuration group by name and version
      parameters:
        - name: name
          in: path
          required: true
          type: string
        - name: version
          in: path
          required: true
          type: string
      responses:
        200:
          description: Group found
          schema:
            $ref: "#/definitions/ConfigurationGroup"
        404:
          description: Group not found

    delete:
      summary: Delete configuration group
      parameters:
        - name: name
          in: path
          required: true
          type: string
        - name: version
          in: path
          required: true
          type: string
      responses:
        204:
          description: Group deleted

  /groups/{name}/versions/{version}/add-config:
    post:
      summary: Add configuration to group with labels
      parameters:
        - name: name
          in: path
          required: true
          type: string
        - name: version
          in: path
          required: true
          type: string
        - name: labeledConfig
          in: body
          required: true
          schema:
            $ref: "#/definitions/LabeledConfiguration"
      responses:
        200:
          description: Configuration added to group

  /groups/{name}/versions/{version}/remove-config:
    post:
      summary: Remove configuration from group
      parameters:
        - name: name
          in: path
          required: true
          type: string
        - name: version
          in: path
          required: true
          type: string
        - name: removeRequest
          in: body
          required: true
          schema:
            $ref: "#/definitions/RemoveConfigRequest"
      responses:
        200:
          description: Configuration removed from group

  /groups/{name}/versions/{version}/configs:
    get:
      summary: Get configurations from group filtered by labels
      parameters:
        - name: name
          in: path
          required: true
          type: string
        - name: version
          in: path
          required: true
          type: string
        - name: env
          in: query
          required: false
          type: string
        - name: region
          in: query
          required: false
          type: string
      responses:
        200:
          description: Filtered configurations
          schema:
            type: array
            items:
              $ref: "#/definitions/LabeledConfiguration"

definitions:

  Config:
    type: object
    properties:
      id:
        type: string
      name:
        type: string
      version:
        type: string
      parameters:
        type: object
        additionalProperties:
          type: string

  LabeledConfiguration:
    type: object
    properties:
      id:
        type: string
      configuration:
        $ref: "#/definitions/Config"
      labels:
        type: object
        additionalProperties:
          type: string

  ConfigurationGroup:
    type: object
    properties:
      id:
        type: string
      name:
        type: string
      version:
        type: string
      configurations:
        type: array
        items:
          $ref: "#/definitions/LabeledConfiguration"

  RemoveConfigRequest:
    type: object
    properties:
      configId:
        type: string
